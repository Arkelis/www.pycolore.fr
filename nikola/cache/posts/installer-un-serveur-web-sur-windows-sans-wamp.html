<h1>Introduction</h1>
<p>La façon la plus simple d'installer un serveur web complet sur Windows est d'avoir recours à WAMP. L'avantage c'est que c'est très facile à utiliser : on ne configure rien à la main ou presque, tout fonctionne tout de suite. Problème :</p>
<ul>
<li>Il faut tout compiler soit même donc il faut au préalable installer je ne sais combien de paquets C++ Redistribuable.</li>
<li>C'est lourd ! WAMP vient avec pas mal d'outils, c'est pratique pour du développement mais on a pas forcément besoin de tout !</li>
<li>Rien configurer n'est pas formateur.</li>
</ul>
<p>Une alternative à WampServer qui a l'air un peu mieu fait est Laragon (voir <a href="https://www.grafikart.fr/tutoriels/php/laragon-1010">la vidéo de Grafikart</a>). Maintenant que PHP offre la possibilité de faire tourner un serveur de développemment intégré, l'installation d'Apache pour du développement peut devenir superflue. Pour un serveur en production, il est préférable d'utiliser des distributions GNU/Linux dédiées. Comme je ne voulais pas installer tout WAMP, j'ai tout installé à la main. C'est ce qu'on va faire dans cet article ! Ce que l'on va installer :</p>
<ul>
<li><a href="https://chocolatey.org">Chocolatey</a> : un gestionnaire de paquets sur Windows, histoire de se familiariser avec un concept assez linuxien</li>
<li><a href="http://php.net/">PHP</a> : langage interprété par les serveurs</li>
<li><a href="https://mariadb.org/">MySQL (MariaDB)</a> : un serveur de bases de données</li>
<li><a href="http://httpd.apache.org/">Apache</a> : quand même assez utile pour ne pas toujours avoir à lancer le serveur intégré de PHP, et permet de faire des tests grandeur nature.</li>
<li><a href="https://www.phpmyadmin.net/">phpMyAdmin</a> : Interface web pour gérer les bases de données.</li>
</ul>
<!-- TEASER_END -->

<h1>Installation de Chocolatey</h1>
<p>Chocolatey est un gestionnaire de paquets qui fonctionne principalement en ligne de commande (cmd ou Windows Powershell). Il permet de facilement installer, mettre à jour et désinstaller des programmes sans passer par les installateurs classiques qui ont parfois tendance à ajouter des programmes tiers inutiles ou indésirables. De nombreux programmes sont disponibles sur le <a href="https://chocolatey.org/packages">dépôt de Chocolatey</a> comme Thunderbird, Firefox, VLC, VSCode et j'en passe. On va ici utiliser Powershell.</p>
<p>Ouvrez Powershell en administrateur (clic droit sur l'icône Windows &gt; Windows Powershell (admin)) et entrez la commande</p>
<pre class="code literal-block"><span></span><span class="nb">Set-ExecutionPolicy</span> <span class="n">Bypass</span> <span class="n">-Scope</span> <span class="k">Process</span> <span class="n">-Force</span><span class="p">;</span> <span class="n">iex</span> <span class="p">((</span><span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Net</span><span class="p">.</span><span class="n">WebClient</span><span class="p">).</span><span class="n">DownloadString</span><span class="p">(</span><span class="s1">&#39;https://chocolatey.org/install.ps1&#39;</span><span class="p">))</span>
</pre>


<h1>Installation et configuration de PHP</h1>
<pre class="code literal-block"><span></span><span class="n">choco</span><span class="p">.</span><span class="n">exe</span> <span class="n">install</span> <span class="n">php</span> <span class="p">-</span><span class="n">-params</span> <span class="s2">&quot;/ThreadSafe /InstallDir:C:\php&quot;</span>
</pre>


<p>Le paramètre <code>/InstallDir</code> est le dossier où sera installé PHP. Si on envisage d'installer plusieurs versions de PHP, on peut par exemple opter pour <code>C:\php\7.2</code> pour la version 7.2. Pour vérifier que PHP est bien installé, on peut ouvrir cmd et demander la version de PHP&nbsp;:</p>
<pre class="code literal-block"><span></span><span class="n">PS</span> <span class="p">&gt;</span> <span class="n">php</span> <span class="n">-v</span>
<span class="n">PHP</span> <span class="n">7</span><span class="p">.</span><span class="n">2</span><span class="p">.</span><span class="n">7</span> <span class="p">(</span><span class="n">cli</span><span class="p">)</span> <span class="p">(</span><span class="n">built</span><span class="err">:</span> <span class="n">Jun</span> <span class="n">19</span> <span class="n">2018</span> <span class="n">23</span><span class="err">:</span><span class="n">14</span><span class="err">:</span><span class="n">45</span><span class="p">)</span> <span class="p">(</span> <span class="n">ZTS</span> <span class="n">MSVC15</span> <span class="p">(</span><span class="n">Visual</span> <span class="n">C</span><span class="p">++</span> <span class="n">2017</span><span class="p">)</span> <span class="n">x64</span> <span class="p">)</span>
<span class="n">Copyright</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="n">1997</span><span class="p">-</span><span class="n">2018</span> <span class="n">The</span> <span class="n">PHP</span> <span class="n">Group</span>
<span class="n">Zend</span> <span class="n">Engine</span> <span class="n">v3</span><span class="p">.</span><span class="n">2</span><span class="p">.</span><span class="n">0</span><span class="p">,</span> <span class="n">Copyright</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="n">1998</span><span class="p">-</span><span class="n">2018</span> <span class="n">Zend</span> <span class="n">Technologies</span>
</pre>


<p>On charge quelques extensions importantes. Dans le dossier de PHP se trouve un fichier <code>php.ini</code>, c'est un fichier de configuration chargé lorsque l'on démarre PHP. On active les extensions en décommentant les lignes correspondantes&nbsp;; il suffit d'enlever le point virgule en début de ligne. On active quelques extensions nécessaires&nbsp;:</p>
<pre class="code literal-block"><span></span><span class="na">extension</span><span class="o">=</span><span class="s">curl ; utile pour télécharger</span>
<span class="na">extension</span><span class="o">=</span><span class="s">intl ; utile pour les traductions</span>
<span class="na">extension</span><span class="o">=</span><span class="s">mysqli ; parle d&#39;elle-même</span>
<span class="na">extension</span><span class="o">=</span><span class="s">pdo_mysql</span>
</pre>


<h1>Installation et configuration d'Apache</h1>
<p>Chocolatey utilise la distribution d'<a href="https://www.apachehaus.com/">Apache Haus</a>.</p>
<pre class="code literal-block"><span></span><span class="n">choco</span><span class="p">.</span><span class="n">exe</span> <span class="n">install</span> <span class="n">apache-httpd</span> <span class="p">-</span><span class="n">-params</span> <span class="s2">&quot;/installLocation:C:\apache2 /port:80&quot;</span>
</pre>


<p>Les paramètres donnés permettent de définir le dossier d'installation et le port qu'Apache écoutera. Pour vérifier l'installation, aller à l'adresse <code>localhost</code> avec votre navigateur, une page devrait apparaître comme ceci&nbsp;:</p>
<p><img src="/apache_index.png"
    width="75%"
    class="center-block" /></p>
<p>Dans le dossier d'Apache se trouve un dossier <code>conf</code> et dans celui-ci un fichier <code>httpd.conf</code>. On ajoute ces lignes au début de celui-ci&nbsp;:</p>
<pre class="code literal-block"><span></span>AddHandler application/x-httpd-php .php
AddType application/x-httpd-php .php .html
LoadModule php7_module &quot;c:/php/php7apache2_4.dll&quot;
PHPIniDir &quot;c:/php&quot; 
</pre>


<p>Les deux premières lignes indiquent en gros à Apache qu'il faut associer les extensions .php et .html à PHP. La troisième et la quatrième indiquent où se trouve PHP et un module nécessaire à Apache.</p>
<p>Il faut également indiquer à Apache de lire en priorité les fichiers PHP, on cherche <code>DirectoryIndex</code> et on ajoute <code>index.php</code>&nbsp;:</p>
<pre class="code literal-block"><span></span><span class="nt">&lt;IfModule</span> <span class="err">dir_module</span><span class="nt">&gt;</span>
    DirectoryIndex index.php index.html
<span class="nt">&lt;/IfModule&gt;</span>
</pre>


<p>Maintenant que l'on a modifié la configuration d'Apache, il faut redémarrer le service. Deux méthodes :</p>
<ul>
<li>utiliser l'interface graphique <code>ApacheMonitor.exe</code> situé dans le dossier <code>bin</code> d'Apache&nbsp;;</li>
<li>aller dans les services de Windows et redémarrer le service Apache à la main.</li>
</ul>
<p>Pour vérifier que ça a marché, on peut créer un fichier dans le dossier <code>htdocs</code> (là où se trouvent les fichiers de vos sites) un fichier <code>index.php</code> qui comportera&nbsp;:</p>
<pre class="code literal-block"><span></span><span class="cp">&lt;?php</span> 
<span class="nb">phpinfo</span><span class="p">()</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre>


<p>En se rendant à <code>localhost</code>, on devrait alors voir&nbsp;:</p>
<p><img src="/phpinfo.png"
    width="75%"
    class="center-block" /></p>
<h1>Installation de MariaDB et de phpMyAdmin</h1>
<pre class="code literal-block"><span></span><span class="n">choco</span><span class="p">.</span><span class="n">exe</span> <span class="n">install</span> <span class="n">mariadb</span>
</pre>


<p>Au moment où j'écris ce mémo, la commande précédente est cassée, il faut donc passer par le site officiel (rien de grave). Pendant l'installation, il faut créer un compte root, bien mémoriser le mot de passe&nbsp;! Pour gérer les bases de données, on peut utiliser l'outil HeidiSQL fourni avec MariaDB ou bien la célèbre interface web phpMyAdmin. Deux moyens de l'installer&nbsp;: en téléchargeant l'archive sur le site officiel ou bien avec Composer, le gestionnaire de dépendances PHP.</p>
<pre class="code literal-block"><span></span><span class="n">choco</span><span class="p">.</span><span class="n">exe</span> <span class="n">install</span> <span class="n">composer</span>
</pre>


<p>Puis dans le dossier <code>htdocs</code>&nbsp;:</p>
<pre class="code literal-block"><span></span><span class="n">composer</span> <span class="n">create-project</span> <span class="n">phpmyadmin</span><span class="p">/</span><span class="n">phpmyadmin</span>
</pre>


<p>Dans le cas où on utilise l'archive, la décompresser dans le dossier <code>htdocs</code>. On se rend ensuite à l'adresse <code>localhost/phpmyadmin/setup</code>. En bas, choisir Français, cliquer sur Télécharger, et copier le fichier <code>conf.inc.php</code> obtenu à la racine de phpMyAdmin (<code>htdocs/phpmyadmin/</code>). On peut alors se connecter à phpMyAdmin en root avec le mot de passe indiqué lors de l'installation. A la première connexion, phpMyAdmin n'est pas configuré&nbsp;; dans le bandeau en bas, cliquer sur Analyse du problème, puis sur Créer. Ça y est, la configuration est terminée ! L'ordinateur possède maintenant une pile WAMP&nbsp;! On peut commencer à développer des sites web dans <code>htdocs</code>.</p>
<h1>Remarques sur les mises à jour</h1>
<p>Avec Chocolatey, il est en général facile de tout mettre à jour, à coup de <code>choco.exe update all</code>. Cependant, cela ne prend pas en compte les arguments que l'on a saisis lors des installations ! Pour celles-ci il faut <code>choco.exe update</code> le programme spécifique avec les même arguments. On fera alors un <code>choco.exe update --exclude=&lt;paquets sensibles&gt; all</code>.</p>